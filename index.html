<!DOCTYPE html>
<html>
<head>
    <title>Poke-Battler: Advanced Turn System</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #1a1a2e; color: #fff; display: flex; flex-direction: column; align-items: center; }
        #game-container { background: #16213e; border: 3px solid #e94560; width: 550px; padding: 20px; border-radius: 15px; }
        
        .battle-scene { display: flex; justify-content: space-around; align-items: center; height: 180px; background: #0f3460; border-radius: 10px; margin-bottom: 10px; }
        .sprite { width: 120px; height: 120px; image-rendering: pixelated; }
        
        /* UI Panels */
        .menu-bar { background: #1a1a2e; padding: 15px; border-radius: 10px; border: 2px solid #444; }
        .action-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        
        button { padding: 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; background: #e94560; color: white; }
        button:disabled { background: #444; cursor: not-allowed; }
        .btn-utility { background: #0f3460; border: 1px solid #00ffcc; color: #00ffcc; }

        #log { height: 80px; overflow-y: auto; font-size: 0.85rem; background: #000; padding: 10px; margin-bottom: 10px; border-radius: 5px; color: #00ff00; }
        .hp-text { font-family: monospace; color: #ff4d4d; }
    </style>
</head>
<body>

    <div id="game-container">
        <div style="display:flex; justify-content: space-between; margin-bottom: 10px;">
            <span>üí∞ $<span id="credits">0</span></span>
            <span>‚≠ê Shop Multiplier: <span id="mult">1.0</span>x</span>
        </div>

        <div id="log">A wild Pok√©mon appeared! Your turn.</div>

        <div class="battle-scene">
            <div class="unit">
                <img id="p-sprite" class="sprite" src="">
                <div id="p-name">---</div>
            </div>
            <div class="unit">
                <img id="e-sprite" class="sprite" src="">
                <div id="e-name">---</div>
                <div class="hp-text">HP: <span id="e-hp">x</span>/50</div>
            </div>
        </div>

        <div class="menu-bar">
            <div id="menu-text">What will you do?</div>
            <div class="action-row" id="main-actions">
                <button onclick="showMoves()">ATTACK</button>
                <button onclick="showParty()">SWAP POKEMON</button>
                <button onclick="useItem()" class="btn-utility">USE ITEM (Potions: <span id="items">1</span>)</button>
                <button onclick="buyUpgrade()" class="btn-utility">UPGRADE ($<span id="cost">50</span>)</button>
            </div>
            <div class="action-row" id="sub-actions" style="display:none;">
                </div>
        </div>
    </div>

<script>
    // Game Data
    let credits = 100;
    let upgradeCost = 50;
    let potions = 1;
    let partyIndex = 0;
    let isPlayerTurn = true;

    const party = [
        { name: "Bulbasaur", id: 1, moves: ["Tackle", "Vine Whip"], pwr: 12 },
        { name: "Charmander", id: 4, moves: ["Scratch", "Ember"], pwr: 14 },
        { name: "Squirtle", id: 7, moves: ["Tackle", "Water Gun"], pwr: 13 }
    ];

    let enemy = { name: "", hp: 50, maxHp: 50, pwr: 8 };

    // Initialization
    async function spawnEnemy() {
        const id = Math.floor(Math.random() * 151) + 1;
        const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${id}`);
        const data = await res.json();
        enemy.name = data.name.toUpperCase();
        enemy.hp = 50;
        document.getElementById('e-sprite').src = data.sprites.front_default;
        document.getElementById('e-name').innerText = enemy.name;
        updateUI();
    }

    function updateUI() {
        document.getElementById('p-sprite').src = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${party[partyIndex].id}.png`;
        document.getElementById('p-name').innerText = party[partyIndex].name;
        document.getElementById('e-hp').innerText = Math.max(0, enemy.hp);
        document.getElementById('credits').innerText = credits;
        document.getElementById('cost').innerText = Math.floor(upgradeCost);
        document.getElementById('items').innerText = potions;
        document.getElementById('main-actions').style.display = isPlayerTurn ? "grid" : "none";
        document.getElementById('sub-actions').style.display = "none";
    }

    // Battle Logic
    function showMoves() {
        const sub = document.getElementById('sub-actions');
        sub.innerHTML = party[partyIndex].moves.map(m => `<button onclick="doAttack('${m}')">${m}</button>`).join('') + `<button onclick="updateUI()" style="background:#444">BACK</button>`;
        document.getElementById('main-actions').style.display = "none";
        sub.style.display = "grid";
    }

    function showParty() {
        const sub = document.getElementById('sub-actions');
        sub.innerHTML = party.map((p, i) => `<button onclick="swap(${i})">${p.name}</button>`).join('') + `<button onclick="updateUI()" style="background:#444">BACK</button>`;
        document.getElementById('main-actions').style.display = "none";
        sub.style.display = "grid";
    }

    function doAttack(moveName) {
        if (!isPlayerTurn) return;
        let dmg = party[partyIndex].pwr + Math.floor(Math.random() * 5);
        enemy.hp -= dmg;
        log(`${party[partyIndex].name} used ${moveName}! Dealt ${dmg} dmg.`, "#00ffcc");
        
        if (enemy.hp <= 0) {
            victory();
        } else {
            isPlayerTurn = false;
            updateUI();
            setTimeout(enemyTurn, 1000);
        }
    }

    function enemyTurn() {
        let dmg = enemy.pwr + Math.floor(Math.random() * 3);
        log(`${enemy.name} attacked back! Dealt ${dmg} dmg.`, "#ff4d4d");
        isPlayerTurn = true;
        updateUI();
    }

    function victory() {
        credits += 30;
        log(`Enemy fainted! Gained $30.`, "#fbd000");
        spawnEnemy();
        isPlayerTurn = true;
    }

    function swap(index) {
        partyIndex = index;
        log(`Go, ${party[index].name}!`);
        isPlayerTurn = false; // Swapping takes a turn
        updateUI();
        setTimeout(enemyTurn, 800);
    }

    function useItem() {
        if(potions > 0) {
            potions--;
            log("Used Potion! (No actual HP yet, but you look cooler)");
            updateUI();
        }
    }

    function buyUpgrade() {
        if (credits >= upgradeCost) {
            credits -= upgradeCost;
            party.forEach(p => p.pwr += 2);
            upgradeCost *= 1.05; // 5% increase
            log("Party power increased by 5%!");
            updateUI();
        }
    }

    function log(m, c="#fff") {
        const l = document.getElementById('log');
        l.innerHTML = `<span style="color:${c}">> ${m}</span><br>${l.innerHTML}`;
    }

    spawnEnemy();
</script>
</body>
</html>
